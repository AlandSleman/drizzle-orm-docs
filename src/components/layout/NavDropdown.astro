---
import DocsIcon from "@components/Icons/DocsIcon.astro";
import LearnIcon from "@components/Icons/LearnIcon.astro";
const { pathname } = Astro.url;

const isDocs = ["docs", "kit-docs", "drizzle-studio"].some((path) =>
  pathname.startsWith(`/${path}`),
);
const isLearn = pathname.startsWith("/learn");
const condition = isDocs ? "/docs/overview" : "/learn";
---

<div class="logo__section__selector">
  <button class="logo__section__dropdown-btn" data-section-selector>
    <div class="docs-text">
      <div class="logo__section-icon">
        <span class="logo__section-icon--docs">
          {isDocs && <DocsIcon />}
        </span>
        {isLearn && <LearnIcon />}
      </div>
      <div class="logo__section-text">
        {isDocs && "Docs"}
        {isLearn && "Learn"}
      </div>
    </div>
    <div class="logo__section__selector-current-num" data-current-section-num>
      {isDocs && "1"}
      {isLearn && "2"}
    </div>
  </button>
  <div class="logo__section__selector-items hidden">
    <a class="logo__section__selector-item--docs" href="/docs/overview">
      <div class="logo__section__selector-item__icon">
        <DocsIcon />
      </div>
      <div>Docs</div>
      <div class="logo__section__selector-current-num--dropdown">1</div>
    </a>
    <a class="logo__section__selector-item" href="/learn">
      <div class="logo__section__selector-item__icon">
        <LearnIcon />
      </div>
      <div>Learn</div>
      <div class="logo__section__selector-current-num--dropdown">2</div>
    </a>
  </div>
</div>

<!-- MOBILE -->
<div class="logo__section__dropdown-select">
  <div class="logo__section__dropdown-content">
    <div class="logo__section-icon">
      <span class="logo__section-icon--docs">
        {isDocs && <DocsIcon />}
      </span>
      {isLearn && <LearnIcon />}
    </div>
    <div class="logo__section-text">
      {isDocs && "Docs"}
      {isLearn && "Learn"}
    </div>
  </div>
  <select
    id="section__select"
    aria-label="Section selector"
    title="Select section"
    class="section__select"
  >
    <option selected={isDocs} value="docs">Docs</option>
    <option selected={isLearn} value="learn">Learn</option>
  </select>
</div>

<style>
  .logo-wrap {
    display: flex;
    align-items: center;
    font-weight: 600;
  }

  .logo-svg svg {
    width: 36px;
    height: 36px;
    color: #000000;
    margin-right: 4px;
  }

  html[class~="dark"] .logo-svg svg {
    color: #c5f74f;
  }

  html[class~="dark"] .logo__section-icon {
    background-color: rgb(16, 42, 76);
  }

  .logo__section-icon {
    margin-right: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgb(225, 240, 255);
    border-radius: 4px;
    height: 24px;
    width: 24px;
  }

  html.dark .logo__section-text {
    color: rgb(243, 244, 246);
  }

  .logo__section-text {
    color: #000;
    margin-right: 4px;
  }

  .docs-text {
    display: flex;
    align-items: center;
  }

  .nav_logo {
    outline-offset: 2px;
    outline: 2px solid transparent;
    border-radius: 4px;
    display: flex;
    align-items: center;
  }

  html.dark .logo__section__selector {
    background-color: #111;
    border: 1px solid #404040;
  }

  .logo__section__selector {
    position: relative;
    user-select: none;
    color: #7e868c;
    background-color: hsla(210, 7%, 95%, .27);
    border: 1px solid rgba(33, 39, 46, .12);
    border-radius: 4px;
  }

  .logo__section__dropdown-btn {
    display: flex;
    align-items: center;
    height: 40px;
    cursor: pointer;
    padding: 0 8px;
    border-radius: 4px;
    width: 100%;
    transition: background-color 0.2s ease-in-out;
  }

  html.dark .logo__section__selector-item__icon {
    background-color: #102a4c;
  }

  .logo__section__selector-item__icon {
    display: flex;
    height: 24px;
    width: 24px;
    align-items: center;
    justify-content: center;
    background-color: #e1f0ff;
    margin-right: 8px;
    border-radius: 4px;
  }

  html.dark .logo__section__dropdown-btn:hover {
    background-color: #171717;
  }

  .logo__section__dropdown-btn:hover {
    background-color: #f8fafc;
    border-color: #d1d5db;
  }

  html.dark .logo__section__selector-current-num,
  html.dark .logo__section__selector-current-num--dropdown {
    background-color: #171717;
  }
  .logo__section__mobile-btn {
    display: none;
  }
  .logo__section__selector-current-num,
  .logo__section__selector-current-num--dropdown {
    align-items: center;
    cursor: pointer;
    display: flex;
    flex-direction: row;
    font-weight: 600;
    gap: 2px;
    height: 20px;
    color: #909090;
    border-radius: 4px;
    justify-content: center;
    position: relative;
    width: 20px;
    font-size: 12px;
    background-color: #f5f5f7;
    margin-left: auto;
  }

  html.dark .logo__section__selector-current-num--dropdown {
    background-color: #1b1b1b;
  }

  .logo__section__selector-current-num--dropdown {
    background-color: #ececf0;
  }

  html.dark .logo__section__selector-items {
    background-color: #111;
    border: 1px solid #333;
    box-shadow: none;
  }

  .logo__section__selector-items {
    border-radius: 4px;
    background: #fff;
    border: 1px solid #e4e4e5;
    box-shadow: 0 0 16px rgba(17, 17, 26, 0.1);
    border-radius: 4px;
    flex-direction: column;
    gap: 2px;
    position: absolute;
    left: -1px;
    right: -1px;
    top: calc(100% + 4px);
    z-index: 99;
  }

  .logo__section__selector-item,
  .logo__section__selector-item--docs {
    align-items: center;
    border-radius: 2px;
    cursor: pointer;
    display: flex;
    justify-content: flex-start;
    width: 100%;
    height: 40px;
    color: #6b7280;
    font-size: 16px;
    font-weight: 500;
    transition-property: color, background-color;
    transition-duration: 0.2s;
    transition-timing-function: ease-in-out;
    padding: 0 8px;
  }

  html.dark .logo__section__selector-item:hover,
  html.dark .logo__section__selector-item--docs:hover,
  html.dark .logo__section__selector-item:focus,
  html.dark .logo__section__selector-item--docs:focus {
    background-color: #171717;
    color: #f3f4f6;
  }

  .logo__section__selector-item:hover,
  .logo__section__selector-item--docs:hover,
  .logo__section__selector-item:focus,
  .logo__section__selector-item--docs:focus {
    background-color: #f5f5f7;
    color: #000;
  }

  .logo__section__dropdown-select {
    position: relative;
    display: none;
  }

  .section__select {
    appearance: none;
    background: none;
    color: transparent;
    cursor: pointer;
    right: 0;
    left: 0;
    position: absolute;
    top: 0;
    bottom: 0;
  }

  html.dark .logo__section__dropdown-content {
    background-color: #111;
    border: 1px solid #404040;
  }

  .logo__section__dropdown-content {
    align-items: center;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    height: 40px;
    padding: 0 8px;
    transition: background-color 0.2s ease-in-out;
    width: 100%;
    border-radius: 4px;
    background-color: hsla(210, 7%, 95%, .27);
    border: 1px solid rgba(33, 39, 46, .12);
  }

  @media screen and (max-width: 768px) {
    .logo__section__selector {
      display: none;
    }
    .logo__section__dropdown-select {
      display: flex;
    }
  }
</style>
<script>
  const sectionSelector = document.querySelector("[data-section-selector]");

  const currentSectionNum = document.querySelector(
    "[data-current-section-num]",
  );
  const sectionSelectorItems = document.querySelector(
    ".logo__section__selector-items",
  );
  if (sectionSelector && sectionSelectorItems) {
    sectionSelector.addEventListener("click", (e) => {
      e.stopPropagation();
      sectionSelector.classList.toggle("logo__section__selector-item--active");
      sectionSelectorItems.classList.toggle("hidden");
    });
  }
  window.addEventListener("click", (e) => {
    const clickedElement = e.target as HTMLElement;
    if (!clickedElement.matches(".logo__section__selector-items")) {
      if (
        sectionSelectorItems &&
        sectionSelector &&
        !sectionSelectorItems.classList.contains("hidden") &&
        sectionSelector.classList.contains(
          "logo__section__selector-item--active",
        )
      ) {
        sectionSelector.classList.remove(
          "logo__section__selector-item--active",
        );
        sectionSelectorItems.classList.add("hidden");
      }
    }
  });

  let pos = 0;
  let maxpos = sectionSelectorItems
    ? sectionSelectorItems.children.length - 1
    : 0;

  window.addEventListener("keydown", (e) => {
    if (
      !e.metaKey &&
      (e.key === "1" || e.key === "2") &&
      document.activeElement!.tagName.toLowerCase() !== "input" &&
      document.activeElement!.tagName.toLowerCase() !== "textarea" &&
      document.activeElement!.id !== "inkeep-shadow:r2:"
    ) {
      e.preventDefault();
      if (sectionSelectorItems && sectionSelector && currentSectionNum) {
        pos = +e.key - 1;
        if (
          currentSectionNum.textContent?.trim() === e.key &&
          sectionSelectorItems.classList.contains("hidden")
        ) {
          sectionSelector.classList.add("logo__section__selector-item--active");
          sectionSelectorItems.classList.remove("hidden");
        } else {
          if (e.key === "1") {
            window.location.href = "/docs/overview";
          }
          if (e.key === "2") {
            window.location.href = "/learn";
          }
        }
      }
    }
    if (e.key === "Escape") {
      if (sectionSelectorItems && sectionSelector) {
        sectionSelector.classList.remove(
          "logo__section__selector-item--active",
        );
        sectionSelectorItems.classList.add("hidden");
      }
    }
    if (
      sectionSelectorItems &&
      !sectionSelectorItems?.classList.contains("hidden")
    ) {
      if (e.key === "ArrowUp") {
        e.preventDefault();
        pos = pos == 0 ? maxpos : pos - 1;
      }
      if (e.key === "ArrowDown") {
        e.preventDefault();
        pos = pos == maxpos ? 0 : pos + 1;
      }
      (sectionSelectorItems.children[pos] as HTMLAnchorElement).focus();
    }
  });

  const sectionSelect = document.getElementById("section__select");
  if (sectionSelect) {
    sectionSelect.addEventListener("change", (e) => {
      const value = (e.target as HTMLSelectElement).value;
      if (value === "docs") {
        window.location.href = "/docs/overview";
      }
      if (value === "learn") {
        window.location.href = "/learn";
      }
    });
  }
</script>
<style is:global>
  html.dark .logo__section-icon svg {
    color: rgb(150, 199, 242);
  }

  html.dark .logo__section__selector-item--docs svg {
    color: #3f4149;
    fill: #6b7280;
  }

  html.dark .logo__section-icon--docs svg,
  html.dark .logo__section__selector-item--docs:hover svg,
  .logo__section__selector-item--docs:hover svg,
  html.dark .logo__section__selector-item--docs:focus svg,
  .logo__section__selector-item--docs:focus svg {
    color: rgb(0, 106, 220);
    fill: rgb(150, 199, 242);
  }

  .logo__section__selector-item--docs svg {
    color: #6b7280;
    fill: #b6b8c0;
  }

  .logo__section-icon svg {
    width: 16px;
    height: 16px;
    color: rgb(0, 106, 220);
    fill: rgb(150, 199, 242);
  }

  html.dark .logo__section__selector-item:hover svg,
  html.dark .logo__section__selector-item:focus svg {
    color: #96c7f2;
  }
  .logo__section__selector-item:hover svg,
  .logo__section__selector-item:focus svg {
    color: #006adc;
  }
  .logo__section__selector-item svg,
  .logo__section__selector-item--docs svg {
    width: 16px;
    height: 16px;
    color: rgb(107, 114, 128);
    transition: all 0.2s ease-in-out;
  }

  html.dark .logo__section__selector-item--active {
    background-color: #171717;
  }

  .logo__section__selector-item--active {
    background-color: #f5f5f7;
  }

  .logo__section__selector-item--active .logo__section__selector-chevron {
    opacity: 1 !important;
  }
</style>
